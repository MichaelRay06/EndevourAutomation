"use strict";
/* IMPORT */
Object.defineProperty(exports, "__esModule", { value: true });
const file_1 = require("../utils/file");
const memory_1 = require("./memory");
/* FILE */
class ProviderFile extends memory_1.default {
    constructor(options) {
        super(options);
        if (!options.path)
            throw new Error('You need to provide a path');
        this.path = options.path;
        if (options.watch !== false)
            this.watch();
    }
    dispose() {
        this.unwatch();
    }
    watch() {
        this.watcher = file_1.default.watch(this.path, async () => {
            const { data, dataRaw } = await this.read();
            if (this.isEqual(dataRaw) && this.isEqual(data))
                return;
            super.write(data, true);
        });
    }
    unwatch() {
        if (!this.watcher)
            return;
        this.watcher.close();
        delete this.watcher;
    }
}
/* EXPORT */
exports.default = ProviderFile;
